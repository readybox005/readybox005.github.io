<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>è‡ªåŠ¨æ‰“å¼€é“¾æ¥å·¥å…·ã€æ™ºèƒ½æ¨¡æ‹Ÿäººç±»è¡Œä¸ºã€‘</title>
    <style>
        * {margin:0;padding:0;box-sizing:border-box;}
        body {padding:20px;font-family:å¾®è½¯é›…é»‘, Arial;width:950px;margin:0 auto;line-height:1.8;}
        h2 {color:#2c3e50;text-align:center;margin-bottom:20px;}
        .config {margin:15px 0;padding:10px;background:#f5f7fa;border-radius:6px;}
        .config input {width:80px;padding:6px;margin:0 5px;border:1px solid #ddd;border-radius:4px;text-align:center;}
        .speed-btns {margin:10px 0;padding:8px;background:#e8f4f8;border-radius:6px;text-align:center;}
        .speed-btns button {padding:6px 12px;margin:0 5px;font-size:14px;}
        .url-section {margin:15px 0;}
        .url-section span {color:#3498db;font-weight:bold;display:block;margin-bottom:8px;}
        textarea {width:100%;height:180px;padding:10px;border:1px solid #ddd;border-radius:6px;margin:5px 0;resize:none;font-size:14px;}
        button {padding:10px 20px;margin:0 8px;border:none;border-radius:6px;font-size:16px;cursor:pointer;transition:all 0.2s;}
        button:hover {opacity:0.9;transform:scale(1.02);}
        #startBtn {background:#27ae60;color:#fff;}
        #stopBtn {background:#e74c3c;color:#fff;}
        #clearPendingBtn {background:#95a5a6;color:#fff;}
        #clearCompletedBtn {background:#6c757d;color:#fff;}
        #status {margin-top:20px;font-size:16px;color:#e74c3c;font-weight:bold;text-align:center;}
        .tips {margin-top:15px;padding:10px;background:#fff8e1;border:1px solid #ffeaa7;border-radius:6px;color:#6d4c41;font-size:13px;}
        .section-divider {height:1px;background:#eee;margin:20px 0;}
        /* åˆ›æ„1ï¼šè¿›åº¦æ¡æ ·å¼ */
        .progress-container {margin:15px 0;padding:10px;background:#f8f9fa;border-radius:6px;}
        .progress-bar {height:10px;background:#e9ecef;border-radius:5px;overflow:hidden;margin:8px 0;}
        .progress-fill {height:100%;background:#27ae60;border-radius:5px;width:0%;transition:width 0.1s linear;}
        .progress-label {font-size:14px;color:#495057;display:flex;justify-content:space-between;}
        /* åˆ›æ„2ï¼šæ—¥å¿—æ ·å¼ */
        .log-section {margin:15px 0;}
        #logList {height:120px;overflow-y:auto;border:1px solid #ddd;border-radius:6px;padding:10px;font-size:13px;line-height:1.6;color:#333;}
        .log-success {color:#27ae60;}
        .log-error {color:#e74c3c;}
        .log-info {color:#3498db;}
    </style>
</head>
<body>
    <h2>è‡ªåŠ¨æ‰“å¼€é“¾æ¥å·¥å…·ã€æ™ºèƒ½æ¨¡æ‹Ÿäººç±»è¡Œä¸ºã€‘</h2>

    <!-- åˆ›æ„3ï¼šé€Ÿåº¦æ¡£ä½ä¸€é”®åˆ‡æ¢ -->
    <div class="speed-btns">
        âš¡ æ‰§è¡Œé€Ÿåº¦æ¡£ä½ï¼š
        <button id="fastSpeed">å¿«é€Ÿï¼ˆé—´éš”5-10s/è§‚çœ‹3-5sï¼‰</button>
        <button id="normalSpeed" style="background:#3498db;color:#fff;">æ™®é€šï¼ˆé—´éš”20-60s/è§‚çœ‹8-15sï¼‰</button>
        <button id="slowSpeed">æ…¢é€Ÿï¼ˆé—´éš”60-120s/è§‚çœ‹15-30sï¼‰</button>
    </div>

    <!-- æ ¸å¿ƒé…ç½®ï¼šä¿®å¤è¾“å…¥åˆæ³•æ€§æ ¡éªŒ -->
    <div class="config">
        âœ… æ‰“å¼€ä¸‹ä¸€ä¸ªé“¾æ¥çš„é—´éš”æ—¶é—´ï¼ˆéšæœºåŒºé—´ï¼‰ï¼š<input type="number" id="intervalMinSec" value="20" min="1" step="1"> ç§’ è‡³ <input type="number" id="intervalMaxSec" value="60" min="1" step="1"> ç§’
        âœ… é¡µé¢åŠ è½½åè§‚çœ‹å¹¶å…³é—­çš„æ€»è€—æ—¶ï¼ˆéšæœºåŒºé—´ï¼‰ï¼š<input type="number" id="watchMinSec" value="8" min="1" step="1"> ç§’ è‡³ <input type="number" id="watchMaxSec" value="15" min="1" step="1"> ç§’
    </div>

    <!-- åˆ›æ„1ï¼šè¿›åº¦æ¡å¯è§†åŒ– -->
    <div class="progress-container">
        <div class="progress-label">
            <span>å½“å‰é“¾æ¥è§‚çœ‹è¿›åº¦ï¼š</span>
            <span id="watchProgressText">0% (0/0ç§’)</span>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="watchProgressBar"></div>
        </div>
        <div class="progress-label">
            <span>ä¸‹ä¸€ä¸ªé“¾æ¥é—´éš”è¿›åº¦ï¼š</span>
            <span id="intervalProgressText">0% (0/0ç§’)</span>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="intervalProgressBar" style="background:#3498db;"></div>
        </div>
    </div>

    <!-- å¾…æ‰§è¡Œé“¾æ¥ -->
    <div class="url-section">
        <span>ğŸ“Œ å¾…æ‰§è¡Œé“¾æ¥ï¼ˆæ¯è¡Œ1ä¸ªï¼Œæ‰§è¡Œåè‡ªåŠ¨ç§»é™¤ï¼‰ï¼š</span>
        <textarea id="pendingUrlList" placeholder="ç¤ºä¾‹ï¼š
https://www.baidu.com
https://uutool.cn/url-open
https://www.qq.com
æ¯è¡Œä¸€ä¸ªé“¾æ¥å³å¯"></textarea>
    </div>

    <div class="section-divider"></div>

    <!-- å·²å®Œæˆé“¾æ¥ -->
    <div class="url-section">
        <span>âœ… å·²å®Œæˆé“¾æ¥ï¼ˆè‡ªåŠ¨ç´¯è®¡ï¼ŒæŒ‰æ‰§è¡Œé¡ºåºï¼‰ï¼š</span>
        <textarea id="completedUrlList" placeholder="æ‰§è¡Œåçš„é“¾æ¥ä¼šè‡ªåŠ¨æ˜¾ç¤ºåœ¨è¿™é‡Œ..." readonly></textarea>
    </div>

    <!-- åˆ›æ„4ï¼šæ‰§è¡Œæ—¥å¿— -->
    <div class="log-section">
        <span>ğŸ“ æ‰§è¡Œæ—¥å¿—ï¼ˆå¯å¤åˆ¶ï¼‰ï¼š</span>
        <div id="logList"></div>
        <button id="exportLogBtn" style="margin-top:8px;padding:6px 12px;font-size:14px;">ğŸ“¤ å¯¼å‡ºæ—¥å¿—</button>
    </div>

    <div style="text-align:center;margin:10px 0;">
        <button id="startBtn">â–¶ï¸ å¼€å§‹æ‰§è¡Œ</button>
        <button id="stopBtn">â¹ï¸ åœæ­¢æ‰§è¡Œ</button>
        <button id="clearPendingBtn">ğŸ—‘ï¸ æ¸…ç©ºå¾…æ‰§è¡Œ</button>
        <button id="clearCompletedBtn">ğŸ—‘ï¸ æ¸…ç©ºå·²å®Œæˆ</button>
    </div>

    <div id="status">ğŸ’¡ å°±ç»ªï¼šè¯·å¡«å†™å¾…æ‰§è¡Œé“¾æ¥åç‚¹å‡»ã€å¼€å§‹æ‰§è¡Œã€‘</div>

    <div class="tips">
        âš ï¸ ä½¿ç”¨é¡»çŸ¥ï¼š1.æµè§ˆå™¨ä¼šæ‹¦æˆªå¼¹çª—ï¼Œé¦–æ¬¡ç‚¹å‡»ä¼šæç¤ºã€å…è®¸å¼¹çª—ã€‘ï¼Œè¯·ç‚¹å‡»å…è®¸ï¼›2.ä»…èƒ½å…³é—­è„šæœ¬è‡ªåŠ¨æ‰“å¼€çš„æ ‡ç­¾é¡µï¼Œæ‰‹åŠ¨æ‰“å¼€çš„ä¸ä¼šå…³ï¼›3.åŒºé—´æœ€å°å€¼ä¸èƒ½å¤§äºæœ€å¤§å€¼ï¼Œéšæœºæ•°ä¼šè‡ªåŠ¨åœ¨åŒºé—´å†…å–å€¼ï¼›
        <br>ğŸ’¡ åˆ›æ„åŠŸèƒ½ï¼šæ”¯æŒç©ºæ ¼å¼€å§‹/åœæ­¢ã€Ctrl+Pæ¸…ç©ºå¾…æ‰§è¡Œã€Ctrl+Cæ¸…ç©ºå·²å®Œæˆï¼›è‡ªåŠ¨ä¿å­˜åˆ—è¡¨ï¼Œåˆ·æ–°ä¸ä¸¢å¤±ï¼›æ¨¡æ‹Ÿäººç±»é¼ æ ‡ç§»åŠ¨/ç‚¹å‡»è¡Œä¸º
    </div>

    <script>
        // è·å–é¡µé¢å…ƒç´ 
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const clearPendingBtn = document.getElementById('clearPendingBtn');
        const clearCompletedBtn = document.getElementById('clearCompletedBtn');
        const intervalMinSec = document.getElementById('intervalMinSec');
        const intervalMaxSec = document.getElementById('intervalMaxSec');
        const watchMinSec = document.getElementById('watchMinSec');
        const watchMaxSec = document.getElementById('watchMaxSec');
        const pendingUrlList = document.getElementById('pendingUrlList');
        const completedUrlList = document.getElementById('completedUrlList');
        const status = document.getElementById('status');
        // åˆ›æ„1ï¼šè¿›åº¦æ¡å…ƒç´ 
        const watchProgressBar = document.getElementById('watchProgressBar');
        const watchProgressText = document.getElementById('watchProgressText');
        const intervalProgressBar = document.getElementById('intervalProgressBar');
        const intervalProgressText = document.getElementById('intervalProgressText');
        // åˆ›æ„3ï¼šé€Ÿåº¦æ¡£ä½å…ƒç´ 
        const fastSpeed = document.getElementById('fastSpeed');
        const normalSpeed = document.getElementById('normalSpeed');
        const slowSpeed = document.getElementById('slowSpeed');
        // åˆ›æ„4ï¼šæ—¥å¿—å…ƒç´ 
        const logList = document.getElementById('logList');
        const exportLogBtn = document.getElementById('exportLogBtn');

        // å…¨å±€å˜é‡
        let timeout = null;
        let isRunning = false;
        let childWindows = [];
        // è¿›åº¦æ¡å®šæ—¶å™¨
        let watchProgressTimer = null;
        let intervalProgressTimer = null;
        // åˆ›æ„5ï¼šæœ¬åœ°å­˜å‚¨é”®å
        const STORAGE_KEY = 'autoUrlOpenerData';

        // ä¿®å¤1ï¼šå¼ºåŒ–éšæœºæ•°ç”Ÿæˆï¼Œç¡®ä¿æ•°å­—ç±»å‹+åŒºé—´åˆæ³•
        function getRandomNumber(min, max) {
            const minNum = Number(min) || 1;
            const maxNum = Number(max) || 1;
            // ç¡®ä¿æœ€å°å€¼â‰¤æœ€å¤§å€¼
            const finalMin = Math.min(minNum, maxNum);
            const finalMax = Math.max(minNum, maxNum);
            const random = Math.random() * (finalMax - finalMin) + finalMin;
            return Math.round(random * 10) / 10; // ä¿ç•™1ä½å°æ•°
        }

        // åˆ›æ„6ï¼šæ¨¡æ‹Ÿäººç±»é¼ æ ‡ç§»åŠ¨ï¼ˆå…¼å®¹è·¨åŸŸï¼‰
        function simulateMouseMove(targetWin, duration) {
            try {
                const startTime = Date.now();
                const moveInterval = setInterval(() => {
                    const elapsed = Date.now() - startTime;
                    if (elapsed >= duration * 1000) {
                        clearInterval(moveInterval);
                        return;
                    }
                    // éšæœºç”Ÿæˆé¼ æ ‡ä½ç½®
                    const x = Math.random() * targetWin.innerWidth;
                    const y = Math.random() * targetWin.innerHeight;
                    // æ¨¡æ‹Ÿé¼ æ ‡ç§»åŠ¨ï¼ˆè·¨åŸŸæ—¶é™çº§ï¼‰
                    try {
                        const event = new MouseEvent('mousemove', {
                            clientX: x,
                            clientY: y,
                            bubbles: true
                        });
                        targetWin.document.dispatchEvent(event);
                    } catch (e) {
                        // è·¨åŸŸæ— æ³•æ“ä½œDOMï¼Œæ— æ“ä½œå³å¯
                    }
                }, 300);
            } catch (e) {}
        }

        // åˆ›æ„7ï¼šæ¨¡æ‹Ÿéšæœºç‚¹å‡»ï¼ˆå…¼å®¹è·¨åŸŸï¼‰
        function simulateRandomClick(targetWin, duration) {
            // æ¯éš”2-3ç§’éšæœºç‚¹å‡»ä¸€æ¬¡
            const clickTimes = Math.floor(duration / 3);
            let clickCount = 0;
            const clickInterval = setInterval(() => {
                if (clickCount >= clickTimes) {
                    clearInterval(clickInterval);
                    return;
                }
                try {
                    const x = Math.random() * targetWin.innerWidth;
                    const y = Math.random() * targetWin.innerHeight;
                    // æ¨¡æ‹Ÿç‚¹å‡»ï¼ˆè·¨åŸŸæ—¶é™çº§ï¼‰
                    try {
                        const event = new MouseEvent('click', {
                            clientX: x,
                            clientY: y,
                            bubbles: true
                        });
                        targetWin.document.dispatchEvent(event);
                    } catch (e) {}
                } catch (err) {}
                clickCount++;
            }, 2000 + Math.random() * 1000);
        }

        // åˆ›æ„8ï¼šé“¾æ¥æœ‰æ•ˆæ€§æ£€æµ‹
        async function checkUrlValidity(url) {
            try {
                const response = await fetch(url, {
                    method: 'HEAD',
                    mode: 'no-cors', // å…¼å®¹è·¨åŸŸ
                    timeout: 5000
                });
                return true;
            } catch (e) {
                addLog(`âš ï¸ é“¾æ¥æœ‰æ•ˆæ€§æ£€æµ‹å¤±è´¥ï¼š${url}ï¼ˆå¯èƒ½è·¨åŸŸ/æ— æ³•è®¿é—®ï¼‰`, 'error');
                return false;
            }
        }

        // ä¿®å¤2ï¼šè¿›åº¦æ¡æ›´æ–°å‡½æ•°
        function updateProgressBar(bar, textEl, current, total, label) {
            const percent = Math.min(Math.round((current / total) * 100), 100);
            bar.style.width = `${percent}%`;
            textEl.textContent = `${percent}% (${current.toFixed(1)}/${total.toFixed(1)}ç§’)`;
            if (label) textEl.previousElementSibling.textContent = label;
        }

        // æ¸…ç©ºè¿›åº¦æ¡
        function clearProgressBars() {
            clearInterval(watchProgressTimer);
            clearInterval(intervalProgressTimer);
            watchProgressBar.style.width = '0%';
            intervalProgressBar.style.width = '0%';
            watchProgressText.textContent = '0% (0/0ç§’)';
            intervalProgressText.textContent = '0% (0/0ç§’)';
        }

        // å…¼å®¹è·¨åŸŸçš„æ»šåŠ¨åˆ°åº•éƒ¨é€»è¾‘ï¼ˆä¼˜åŒ–ï¼‰
        function scrollToBottom(targetWin, scrollTime) {
            try {
                let totalHeight = 0;
                if (targetWin.document) {
                    totalHeight = Math.max(
                        targetWin.document.body.scrollHeight,
                        targetWin.document.documentElement.scrollHeight
                    ) - targetWin.innerHeight;
                }
                totalHeight = Math.max(totalHeight, 0);

                const startTime = Date.now();
                const scrollInterval = setInterval(() => {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / (scrollTime * 1000), 1);
                    try {
                        targetWin.scrollTo({
                            top: totalHeight * progress,
                            behavior: 'smooth'
                        });
                    } catch (e) {
                        targetWin.scrollTo(0, totalHeight * progress);
                    }
                    if (progress >= 1) clearInterval(scrollInterval);
                }, 50);
            } catch (e) {
                const scrollStep = 1000;
                let currentScroll = 0;
                const scrollInterval = setInterval(() => {
                    currentScroll += scrollStep;
                    try {
                        targetWin.scrollTo(0, currentScroll);
                    } catch (err) {}
                    if (currentScroll >= scrollTime * 1000) {
                        clearInterval(scrollInterval);
                        try {
                            targetWin.scrollTo(0, 999999);
                        } catch (err) {}
                    }
                }, 50);
            }
        }

        // å…¼å®¹è·¨åŸŸçš„é¡µé¢åŠ è½½åˆ¤æ–­
        function waitForPageLoad(targetWin) {
            return new Promise(resolve => {
                const maxWaitTime = 10000;
                let waitTime = 0;

                const checkLoad = () => {
                    waitTime += 300;
                    try {
                        if (targetWin.document?.readyState === 'complete') {
                            resolve();
                        } else if (waitTime >= maxWaitTime) {
                            resolve();
                        } else {
                            setTimeout(checkLoad, 300);
                        }
                    } catch (e) {
                        setTimeout(resolve, 2000);
                    }
                };
                checkLoad();
            });
        }

        // æ›´æ–°é“¾æ¥åˆ—è¡¨
        function updateUrlLists(executedUrl) {
            const pendingUrls = pendingUrlList.value.split('\n').filter(item => item.trim());
            const remainingPending = pendingUrls.filter(url => url.trim() !== executedUrl.trim());
            pendingUrlList.value = remainingPending.join('\n');

            const completedUrls = completedUrlList.value.split('\n').filter(item => item.trim());
            completedUrls.push(executedUrl.trim());
            completedUrlList.value = completedUrls.join('\n');

            // åˆ›æ„5ï¼šè‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            saveToLocalStorage();
        }

        // åˆ›æ„4ï¼šæ·»åŠ æ—¥å¿—å‡½æ•°
        function addLog(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const logItem = document.createElement('div');
            logItem.className = `log-${type}`;
            logItem.innerHTML = `[${time}] ${message}`;
            logList.appendChild(logItem);
            // æ»šåŠ¨åˆ°æœ€æ–°æ—¥å¿—
            logList.scrollTop = logList.scrollHeight;
        }

        // åˆ›æ„5ï¼šä»æœ¬åœ°å­˜å‚¨åŠ è½½
        function loadFromLocalStorage() {
            const data = localStorage.getItem(STORAGE_KEY);
            if (data) {
                const parsed = JSON.parse(data);
                pendingUrlList.value = parsed.pending || '';
                completedUrlList.value = parsed.completed || '';
                addLog('âœ… å·²ä»æœ¬åœ°åŠ è½½å†å²é“¾æ¥åˆ—è¡¨', 'success');
            }
        }

        // åˆ›æ„5ï¼šä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        function saveToLocalStorage() {
            const data = {
                pending: pendingUrlList.value,
                completed: completedUrlList.value,
                logs: logList.innerHTML
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        // åˆ›æ„4ï¼šå¯¼å‡ºæ—¥å¿—
        function exportLog() {
            const logText = logList.innerText;
            const blob = new Blob([logText], { type: 'text/plain' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `è‡ªåŠ¨æ‰“å¼€é“¾æ¥æ—¥å¿—_${new Date().toLocaleDateString().replace(/\//g, '-')}.txt`;
            a.click();
            URL.revokeObjectURL(a.href);
        }

        // æ ¸å¿ƒæ‰§è¡Œæ–¹æ³•ï¼ˆä¿®å¤+åˆ›æ„ï¼‰
        async function runTask() {
            if (!isRunning) return;

            const pendingUrls = pendingUrlList.value.split('\n').filter(item => item.trim());
            if (pendingUrls.length === 0) {
                isRunning = false;
                clearProgressBars();
                const completedCount = completedUrlList.value.split('\n').filter(item => item.trim()).length;
                status.innerHTML = `âœ… æ‰§è¡Œå®Œæˆï¼šå…±å®Œæˆ ${completedCount} ä¸ªé“¾æ¥ï¼Œå¾…æ‰§è¡Œåˆ—è¡¨ä¸ºç©ºï¼`;
                status.style.color = "#27ae60";
                addLog(`âœ… æ‰§è¡Œå®Œæˆï¼šå…±å®Œæˆ${completedCount}ä¸ªé“¾æ¥`, 'success');
                return;
            }

            const currentUrl = pendingUrls[0].trim();
            // åˆ›æ„8ï¼šå…ˆæ£€æµ‹é“¾æ¥æœ‰æ•ˆæ€§
            await checkUrlValidity(currentUrl);

            try {
                const completedCount = completedUrlList.value.split('\n').filter(item => item.trim()).length;
                status.innerHTML = `ğŸ”„ æ­£åœ¨æ‰§è¡Œç¬¬ ${completedCount + 1} ä¸ªé“¾æ¥ â†’ ${currentUrl}ï¼ˆå¾…æ‰§è¡Œå‰©ä½™ï¼š${pendingUrls.length - 1}ï¼‰`;
                status.style.color = "#2980b9";
                addLog(`ğŸ”„ å¼€å§‹æ‰§è¡Œç¬¬${completedCount + 1}ä¸ªé“¾æ¥ï¼š${currentUrl}`, 'info');
                
                const newWin = window.open('about:blank', '_blank');
                if (!newWin) {
                    status.innerHTML = "âŒ æµè§ˆå™¨æ‹¦æˆªäº†å¼¹çª—ï¼è¯·ç‚¹å‡»ã€å…è®¸æ­¤ç½‘ç«™çš„å¼¹çª—ã€‘åé‡è¯•";
                    status.style.color = "#e74c3c";
                    addLog("âŒ æµè§ˆå™¨æ‹¦æˆªå¼¹çª—ï¼Œæ‰§è¡Œç»ˆæ­¢", 'error');
                    isRunning = false;
                    return;
                }
                childWindows.push(newWin);
                newWin.location.href = currentUrl;

                await waitForPageLoad(newWin);

                // ä¿®å¤3ï¼šæ˜¾å¼è½¬æ•°å­—ï¼Œç¡®ä¿åŒºé—´æ­£ç¡®
                const randomWatchTime = getRandomNumber(watchMinSec.value, watchMaxSec.value);
                addLog(`âŒ› æœ¬æ¬¡è§‚çœ‹è€—æ—¶ï¼š${randomWatchTime}ç§’ï¼ˆæ»šåŠ¨å 80%ï¼Œåœç•™å 20%ï¼‰`, 'info');
                
                // å¯åŠ¨è§‚çœ‹è¿›åº¦æ¡
                let currentWatchTime = 0;
                clearInterval(watchProgressTimer);
                watchProgressTimer = setInterval(() => {
                    currentWatchTime += 0.1;
                    updateProgressBar(watchProgressBar, watchProgressText, currentWatchTime, randomWatchTime, 'å½“å‰é“¾æ¥è§‚çœ‹è¿›åº¦ï¼š');
                    if (currentWatchTime >= randomWatchTime) {
                        clearInterval(watchProgressTimer);
                    }
                }, 100);

                const scrollTime = randomWatchTime * 0.8;
                scrollToBottom(newWin, scrollTime);
                // åˆ›æ„6ï¼šæ¨¡æ‹Ÿé¼ æ ‡ç§»åŠ¨
                simulateMouseMove(newWin, scrollTime);
                // åˆ›æ„7ï¼šæ¨¡æ‹Ÿéšæœºç‚¹å‡»
                simulateRandomClick(newWin, randomWatchTime);

                setTimeout(() => {
                    try {
                        newWin.close();
                        childWindows = childWindows.filter(win => win !== newWin);
                        updateUrlLists(currentUrl);
                        const newCompletedCount = completedUrlList.value.split('\n').filter(item => item.trim()).length;
                        status.innerHTML = `âœ… å·²å®Œæˆï¼š${currentUrl}ï¼ˆç´¯è®¡å®Œæˆï¼š${newCompletedCount}ï¼Œå¾…æ‰§è¡Œå‰©ä½™ï¼š${pendingUrls.length - 1}ï¼Œæœ¬æ¬¡è§‚çœ‹è€—æ—¶ï¼š${randomWatchTime}ç§’ï¼‰`;
                        addLog(`âœ… å®Œæˆæ‰§è¡Œï¼š${currentUrl}ï¼ˆç´¯è®¡å®Œæˆ${newCompletedCount}ä¸ªï¼‰`, 'success');
                    } catch (e) {
                        status.innerHTML = `âš ï¸ è·¨åŸŸé™åˆ¶ï¼šæ— æ³•å…³é—­ ${currentUrl} æ ‡ç­¾é¡µï¼Œå·²æ›´æ–°é“¾æ¥åˆ—è¡¨ï¼ˆæœ¬æ¬¡è§‚çœ‹è€—æ—¶ï¼š${randomWatchTime}ç§’ï¼‰`;
                        addLog(`âš ï¸ è·¨åŸŸé™åˆ¶ï¼šæ— æ³•å…³é—­${currentUrl}æ ‡ç­¾é¡µ`, 'error');
                        updateUrlLists(currentUrl);
                    }

                    // ç”Ÿæˆä¸‹ä¸€ä¸ªé—´éš”æ—¶é—´
                    const randomInterval = getRandomNumber(intervalMinSec.value, intervalMaxSec.value);
                    addLog(`âŒ› ä¸‹ä¸€ä¸ªé“¾æ¥å°†åœ¨${randomInterval}ç§’åæ‰§è¡Œ`, 'info');
                    status.innerHTML += ` â†’ ä¸‹ä¸€ä¸ªé“¾æ¥å°†åœ¨ ${randomInterval} ç§’åæ‰§è¡Œ`;

                    // å¯åŠ¨é—´éš”è¿›åº¦æ¡
                    let currentIntervalTime = 0;
                    clearInterval(intervalProgressTimer);
                    intervalProgressTimer = setInterval(() => {
                        currentIntervalTime += 0.1;
                        updateProgressBar(intervalProgressBar, intervalProgressText, currentIntervalTime, randomInterval, 'ä¸‹ä¸€ä¸ªé“¾æ¥é—´éš”è¿›åº¦ï¼š');
                        if (currentIntervalTime >= randomInterval) {
                            clearInterval(intervalProgressTimer);
                        }
                    }, 100);

                    timeout = setTimeout(runTask, randomInterval * 1000);
                }, randomWatchTime * 1000);

            } catch (err) {
                status.innerHTML = `âŒ æ‰§è¡Œå¤±è´¥ï¼š${currentUrl} â†’ ${err.message}ï¼Œå·²ç§»å…¥å·²å®Œæˆåˆ—è¡¨`;
                status.style.color = "#e74c3c";
                addLog(`âŒ æ‰§è¡Œå¤±è´¥ï¼š${currentUrl} - ${err.message}`, 'error');
                updateUrlLists(currentUrl);

                const randomInterval = getRandomNumber(intervalMinSec.value, intervalMaxSec.value);
                timeout = setTimeout(runTask, randomInterval * 1000);
                status.innerHTML += ` â†’ ä¸‹ä¸€ä¸ªé“¾æ¥å°†åœ¨ ${randomInterval} ç§’åæ‰§è¡Œ`;
            }
        }

        // è¾“å…¥åˆæ³•æ€§æ ¡éªŒ
        function validateInputs() {
            const intervalMin = Number(intervalMinSec.value);
            const intervalMax = Number(intervalMaxSec.value);
            const watchMin = Number(watchMinSec.value);
            const watchMax = Number(watchMaxSec.value);

            if (intervalMin > intervalMax) {
                status.innerHTML = "âŒ é—´éš”æ—¶é—´æœ€å°å€¼ä¸èƒ½å¤§äºæœ€å¤§å€¼ï¼";
                status.style.color = "#e74c3c";
                return false;
            }
            if (watchMin > watchMax) {
                status.innerHTML = "âŒ è§‚çœ‹æ—¶é—´æœ€å°å€¼ä¸èƒ½å¤§äºæœ€å¤§å€¼ï¼";
                status.style.color = "#e74c3c";
                return false;
            }
            if (intervalMin < 1 || watchMin < 1) {
                status.innerHTML = "âŒ æ—¶é—´ä¸èƒ½å°äº1ç§’ï¼";
                status.style.color = "#e74c3c";
                return false;
            }
            return true;
        }

        // äº‹ä»¶ç›‘å¬
        startBtn.addEventListener('click', () => {
            if (isRunning) return;
            const pendingText = pendingUrlList.value.trim();
            if (!pendingText) {
                status.innerHTML = "âŒ è¯·å…ˆå¡«å†™å¾…æ‰§è¡Œé“¾æ¥ï¼";
                status.style.color = "#e74c3c";
                return;
            }
            if (!validateInputs()) return;

            isRunning = true;
            status.innerHTML = "â–¶ï¸ å·²å¼€å§‹æ‰§è¡Œï¼è¯·å…è®¸æµè§ˆå™¨å¼¹çª—";
            status.style.color = "#27ae60";
            addLog("â–¶ï¸ å¼€å§‹æ‰§è¡Œä»»åŠ¡", 'success');
            runTask();
        });

        stopBtn.addEventListener('click', () => {
            clearTimeout(timeout);
            clearProgressBars();
            childWindows.forEach(win => {
                try { win.close(); } catch (e) {}
            });
            childWindows = [];
            isRunning = false;
            const pendingCount = pendingUrlList.value.split('\n').filter(item => item.trim()).length;
            const completedCount = completedUrlList.value.split('\n').filter(item => item.trim()).length;
            status.innerHTML = `â¹ï¸ å·²æ‰‹åŠ¨åœæ­¢ï¼ç´¯è®¡å®Œæˆï¼š${completedCount}ï¼Œå¾…æ‰§è¡Œå‰©ä½™ï¼š${pendingCount}`;
            status.style.color = "#e74c3c";
            addLog(`â¹ï¸ æ‰‹åŠ¨åœæ­¢ï¼šç´¯è®¡å®Œæˆ${completedCount}ä¸ªï¼Œå‰©ä½™${pendingCount}ä¸ª`, 'info');
        });

        clearPendingBtn.addEventListener('click', () => {
            pendingUrlList.value = '';
            saveToLocalStorage();
            status.innerHTML = "ğŸ—‘ï¸ å·²æ¸…ç©ºå¾…æ‰§è¡Œé“¾æ¥ï¼";
            status.style.color = "#3498db";
            addLog("ğŸ—‘ï¸ æ¸…ç©ºå¾…æ‰§è¡Œé“¾æ¥åˆ—è¡¨", 'info');
        });

        clearCompletedBtn.addEventListener('click', () => {
            completedUrlList.value = '';
            saveToLocalStorage();
            status.innerHTML = "ğŸ—‘ï¸ å·²æ¸…ç©ºå·²å®Œæˆé“¾æ¥ï¼";
            status.style.color = "#3498db";
            addLog("ğŸ—‘ï¸ æ¸…ç©ºå·²å®Œæˆé“¾æ¥åˆ—è¡¨", 'info');
        });

        // åˆ›æ„3ï¼šé€Ÿåº¦æ¡£ä½åˆ‡æ¢
        fastSpeed.addEventListener('click', () => {
            intervalMinSec.value = 5;
            intervalMaxSec.value = 10;
            watchMinSec.value = 3;
            watchMaxSec.value = 5;
            addLog("âš¡ åˆ‡æ¢åˆ°å¿«é€Ÿæ‰§è¡Œæ¡£ä½", 'info');
        });

        normalSpeed.addEventListener('click', () => {
            intervalMinSec.value = 20;
            intervalMaxSec.value = 60;
            watchMinSec.value = 8;
            watchMaxSec.value = 15;
            addLog("âš¡ åˆ‡æ¢åˆ°æ™®é€šæ‰§è¡Œæ¡£ä½", 'info');
        });

        slowSpeed.addEventListener('click', () => {
            intervalMinSec.value = 60;
            intervalMaxSec.value = 120;
            watchMinSec.value = 15;
            watchMaxSec.value = 30;
            addLog("âš¡ åˆ‡æ¢åˆ°æ…¢é€Ÿæ‰§è¡Œæ¡£ä½", 'info');
        });

        // åˆ›æ„4ï¼šå¯¼å‡ºæ—¥å¿—
        exportLogBtn.addEventListener('click', () => {
            exportLog();
            addLog("ğŸ“¤ å¯¼å‡ºæ‰§è¡Œæ—¥å¿—æˆåŠŸ", 'success');
        });

        // åˆ›æ„2ï¼šå¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', (e) => {
            // ç©ºæ ¼ï¼šå¼€å§‹/åœæ­¢
            if (e.code === 'Space') {
                e.preventDefault();
                isRunning ? stopBtn.click() : startBtn.click();
            }
            // Ctrl+Pï¼šæ¸…ç©ºå¾…æ‰§è¡Œ
            if (e.ctrlKey && e.code === 'KeyP') {
                e.preventDefault();
                clearPendingBtn.click();
            }
            // Ctrl+Cï¼šæ¸…ç©ºå·²å®Œæˆ
            if (e.ctrlKey && e.code === 'KeyC') {
                e.preventDefault();
                clearCompletedBtn.click();
            }
        });

        // é¡µé¢åŠ è½½æ—¶åŠ è½½æœ¬åœ°å­˜å‚¨
        window.addEventListener('load', () => {
            loadFromLocalStorage();
        });

        // è‡ªåŠ¨ä¿å­˜æ—¥å¿—
        setInterval(saveToLocalStorage, 5000);
    </script>
</body>
</html>

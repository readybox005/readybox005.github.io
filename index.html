<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>äºšé©¬é€Šç«å“æŠ“å–-è‡ªå®šä¹‰ç­‰å¾…ç‰ˆ(é€‚é…å–å®¶ç²¾çµ)</title>
    <style>
        * {margin: 8px;padding: 0;box-sizing: border-box;font-size: 14px;}
        body {font-family: å¾®è½¯é›…é»‘, Arial;max-width: 1600px;margin: 20px auto;background: #f5f5f5;}
        .btn {padding: 12px 20px;border: none;border-radius: 6px;margin: 5px;cursor: pointer;font-weight: bold;color: #fff;}
        #getBtn {background: #1677ff;}
        #getBtn:disabled {background: #99c2ff;cursor: not-allowed;}
        #copyBtn {background: #00b42a;}
        #copyBtn:disabled {background: #86e89c;cursor: not-allowed;}
        #downBtn {background: #ff7d00;}
        #downBtn:disabled {background: #ffc299;cursor: not-allowed;}
        #resetBtn {background: #666666;}
        #tips {color: #ff4d4f;padding: 10px;background: #fff8f8;border: 1px solid #ffccc7;border-radius: 6px;margin-bottom: 15px;}
        .setting-box {margin:15px 0;padding:15px;background:#fff;border-radius:6px;border:1px solid #eee;}
        .setting-group {display: flex;flex-wrap: wrap;gap: 15px;margin-bottom: 10px;}
        .setting-item {display: flex;align-items: center;}
        .setting-item label {margin-right: 8px;font-weight: bold;}
        .setting-item input {width: 100px;padding: 6px;border: 1px solid #ccc;border-radius: 4px;}
        .asin-box {margin:15px 0;padding:10px;background:#fff;border-radius:6px;border:1px solid #eee;}
        .asin-box textarea {width:100%;height:120px;padding:10px;border:1px solid #ccc;border-radius:4px;resize:none;outline:none;font-size:14px;}
        .asin-box p {color:#666;margin-top:8px;font-size:13px;}
        table {width: 100%;border-collapse: collapse;background: #fff;margin-top:15px;}
        th,td {border:1px solid #ccc;padding:8px;text-align:center;}
        th {background:#f0f7ff;font-weight:bold;}
        tr:nth-child(even) {background:#f9fcff;}
        .success {color:#00b42a;padding:10px;margin-top:10px;border-radius:4px;}
        .loading {color:#1677ff;padding:10px;margin-top:10px;border-radius:4px;}
        .error {color:#ff4d4f;padding:8px;margin-top:5px;font-size:13px;border-radius:4px;}
        .progress {color:#1677ff;padding:8px;margin-top:5px;font-weight:bold;border-radius:4px;}
    </style>
</head>
<body>
    <div id="tips">âš  è‡ªå®šä¹‰ç­‰å¾…ç‰ˆ âœ… å¯æ ¹æ®ç½‘ç»œæƒ…å†µè°ƒæ•´ç­‰å¾…æ—¶é—´ | å…ˆç­‰é¡µé¢åŠ è½½â†’å†ç­‰æ’ä»¶åŠ è½½ï¼Œæé«˜é‡‡é›†æˆåŠŸç‡</div>
    
    <!-- ç­‰å¾…æ—¶é—´è®¾ç½®åŒºåŸŸ -->
    <div class="setting-box">
        <label><b>â±ï¸ ç­‰å¾…æ—¶é—´è®¾ç½®ï¼ˆå•ä½ï¼šç§’ï¼‰</b></label>
        <div class="setting-group">
            <div class="setting-item">
                <label for="pageLoadWait">äºšé©¬é€Šé¡µé¢åŠ è½½ï¼š</label>
                <input type="number" id="pageLoadWait" min="1" max="60" value="10">
                <span style="margin-left:5px;">ç§’</span>
            </div>
            <div class="setting-item">
                <label for="pluginLoadWait">å–å®¶ç²¾çµæ’ä»¶åŠ è½½ï¼š</label>
                <input type="number" id="pluginLoadWait" min="1" max="60" value="10">
                <span style="margin-left:5px;">ç§’</span>
            </div>
            <div class="setting-item">
                <label for="timeoutExtend">è¶…æ—¶å»¶é•¿æ—¶é—´ï¼š</label>
                <input type="number" id="timeoutExtend" min="1" max="30" value="10">
                <span style="margin-left:5px;">ç§’</span>
            </div>
        </div>
        <p style="color:#666;font-size:13px;">ğŸ’¡ æç¤ºï¼šç½‘ç»œè¾ƒæ…¢æˆ–æ’ä»¶åŠ è½½æ…¢æ—¶ï¼Œè¯·é€‚å½“å¢å¤§æ•°å€¼ï¼ˆ1ç§’=1000æ¯«ç§’ï¼‰</p>
    </div>
    
    <div class="asin-box">
        <label><b>ğŸ“ å¡«å†™ç«å“ASINï¼ˆæ¯è¡Œ1ä¸ªï¼Œä»…æ”¯æŒç¾å›½ç«™10ä½ASINï¼‰</b></label>
        <textarea id="asinInput" placeholder="ä¾‹å¦‚ï¼š
B09XXXXXXX
B08XXXXXXX
B07XXXXXXX
ç›´æ¥ç²˜è´´/è¾“å…¥å³å¯">BOFK3CLKNJ
BOFK3CB9P1
BOFK3BVZQC
BOFK3FM573</textarea>
        <p>âœ… è§„åˆ™ï¼šæ¯è¡Œ1ä¸ªç¾å›½ç«™ASINï¼ˆ10ä½å­—æ¯/æ•°å­—ï¼‰ï¼Œè‡ªåŠ¨æ‰¹é‡æ‰“å¼€+é‡‡é›†+å…³é¡µ</p>
    </div>

    <button class="btn" id="getBtn">âœ… å…¨è‡ªåŠ¨æ‰¹é‡æŠ“å–ï¼ˆè‡ªå®šä¹‰ç­‰å¾…+ç²¾å‡†é‡‡é›†ï¼‰</button>
    <button class="btn" id="resetBtn">ğŸ†‘ æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
    <button class="btn" id="copyBtn" disabled>ğŸ“‹ å¤åˆ¶åˆ°Excel(è‡ªåŠ¨å¯¹é½)</button>
    <button class="btn" id="downBtn" disabled>ğŸ’¾ ä¸‹è½½Excelåˆ†æè¡¨</button>

    <div id="loadingText" class="loading" style="display: none;"></div>
    <div id="progressText" class="progress" style="display: none;"></div>
    <div id="errorText" class="error" style="display: none;"></div>
    <div id="successText" class="success" style="display: none;"></div>

    <table id="dataTable">
        <thead>
            <tr>
                <th>å•†å“ASIN</th>
                <th>å¤§ç±»å+æ’å</th>
                <th>å°ç±»ç›®å+æ’å</th>
                <th>é”€å”®ä»·(ç¾é‡‘)</th>
                <th>æœˆé”€é‡</th>
                <th>è¿‘1å¹´é”€é‡</th>
                <th>ä¸Šæ¶æ—¶é—´</th>
                <th>ç´¯è®¡è¯„è®ºæ•°</th>
                <th>Ratingè¯„åˆ†</th>
                <th>è·Ÿå–æ•°é‡</th>
                <th>FBA/FBM</th>
                <th>å˜ä½“æ•°é‡</th>
                <th>æ–°å“æ ‡</th>
                <th>30å¤©æ–°å¢è¯„è®º</th>
                <th>å¥½è¯„ç‡(%)</th>
                <th>å“ç‰Œåç§°</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <tr><td colspan="16">æš‚æ— æ•°æ®ï¼Œå¡«å†™ASINåç‚¹å‡»ä¸Šæ–¹æŠ“å–æŒ‰é’®å³å¯</td></tr>
        </tbody>
    </table>

<script>
let asinDataList = [];
const AMAZON_US_URL = "https://www.amazon.com/dp/";
const MAX_RETRIES = 3; // æ•°æ®è¯»å–æœ€å¤§é‡è¯•æ¬¡æ•°

// ç»‘å®šæŒ‰é’®äº‹ä»¶
document.getElementById('getBtn').addEventListener('click', startGrabAsinData);
document.getElementById('copyBtn').addEventListener('click', copyAllData);
document.getElementById('downBtn').addEventListener('click', downloadExcel);
document.getElementById('resetBtn').addEventListener('click', resetAllData);

// æ ¸å¿ƒï¼šå…¨è‡ªåŠ¨æŠ“å–ä¸»å‡½æ•°ï¼ˆè‡ªå®šä¹‰ç­‰å¾…+å¤šå±‚æ ¡éªŒï¼‰
async function startGrabAsinData() {
    try {
        // 1. è·å–å¹¶éªŒè¯ç”¨æˆ·è®¾ç½®çš„ç­‰å¾…æ—¶é—´ï¼ˆè½¬æ¢ä¸ºæ¯«ç§’ï¼‰
        const pageLoadWaitInput = document.getElementById('pageLoadWait');
        const pluginLoadWaitInput = document.getElementById('pluginLoadWait');
        const timeoutExtendInput = document.getElementById('timeoutExtend');
        
        const pageLoadWait = parseInt(pageLoadWaitInput.value);
        const pluginLoadWait = parseInt(pluginLoadWaitInput.value);
        const timeoutExtend = parseInt(timeoutExtendInput.value);

        if (isNaN(pageLoadWait) || pageLoadWait < 1 || pageLoadWait > 60) {
            showMsg('error', 'âŒ é¡µé¢åŠ è½½ç­‰å¾…æ—¶é—´éœ€ä¸º1-60ä¹‹é—´çš„æ•°å­—ï¼');
            return;
        }
        if (isNaN(pluginLoadWait) || pluginLoadWait < 1 || pluginLoadWait > 60) {
            showMsg('error', 'âŒ æ’ä»¶åŠ è½½ç­‰å¾…æ—¶é—´éœ€ä¸º1-60ä¹‹é—´çš„æ•°å­—ï¼');
            return;
        }
        if (isNaN(timeoutExtend) || timeoutExtend < 1 || timeoutExtend > 30) {
            showMsg('error', 'âŒ è¶…æ—¶å»¶é•¿æ—¶é—´éœ€ä¸º1-30ä¹‹é—´çš„æ•°å­—ï¼');
            return;
        }

        const PAGE_LOAD_WAIT = pageLoadWait * 1000;
        const PLUGIN_LOAD_WAIT = pluginLoadWait * 1000;
        const TIMEOUT_EXTEND = timeoutExtend * 1000;
        const totalWaitPerAsin = (PAGE_LOAD_WAIT + PLUGIN_LOAD_WAIT) / 1000;

        // 2. è·å–å¹¶é¢„å¤„ç†ASIN
        let asinText = document.getElementById('asinInput').value.trim();
        let asinList = asinText.split('\n').map(asin => asin.trim()).filter(asin => asin);
        if (asinList.length === 0) {
            showMsg('error', 'âŒ è¯·å¡«å†™è‡³å°‘1ä¸ªASINï¼');
            return;
        }

        // 3. åˆå§‹åŒ–çŠ¶æ€
        asinDataList = [];
        showMsg('loading', `ğŸ” å¼€å§‹å…¨è‡ªåŠ¨æŠ“å– â†’ è‡ªå®šä¹‰ç­‰å¾…æ¨¡å¼å·²å¼€å¯ï¼ˆçº¦${totalWaitPerAsin}ç§’/ä¸ªï¼‰ï¼Œè€å¿ƒç­‰å¾…...`);
        showMsg('progress', `ğŸ“Š å¾…æŠ“å–ASINæ€»æ•°ï¼š${asinList.length} ä¸ª | ç­‰å¾…è®¾ç½®ï¼šé¡µé¢åŠ è½½${pageLoadWait}ç§’ + æ’ä»¶åŠ è½½${pluginLoadWait}ç§’`);
        showMsg('error', '');
        showMsg('success', '');
        document.getElementById('getBtn').disabled = true;
        document.getElementById('copyBtn').disabled = true;
        document.getElementById('downBtn').disabled = true;

        let successCount = 0;
        let failCount = 0;
        const total = asinList.length;

        // 4. éå†ASINé€ä¸ªé‡‡é›†
        for (let i = 0; i < total; i++) {
            let asin = asinList[i];
            let current = i + 1;
            let percent = Math.round((current / total) * 100);
            showMsg('progress', `ğŸ“Š æŠ“å–è¿›åº¦ ${current}/${total} (${percent}%) | å½“å‰ASINï¼š${asin}`);

            // æ ¡éªŒ1ï¼šASINæ ¼å¼æ˜¯å¦æœ‰æ•ˆï¼ˆ10ä½å­—æ¯/æ•°å­—ï¼‰
            if (!/^[A-Z0-9]{10}$/.test(asin)) {
                failCount++;
                addFailData(asin, 'ASINæ ¼å¼æ— æ•ˆï¼ˆéœ€10ä½å­—æ¯/æ•°å­—ï¼‰');
                showMsg('error', `âŒ ${asin} é‡‡é›†å¤±è´¥ï¼šASINæ ¼å¼æ— æ•ˆï¼ˆéœ€10ä½å­—æ¯/æ•°å­—ï¼‰`);
                renderTableData();
                continue;
            }

            // æ‰“å¼€äºšé©¬é€Šå•†å“é¡µ
            let amazonWin = window.open(`${AMAZON_US_URL}${asin}`, '_blank');
            if (!amazonWin) {
                failCount++;
                addFailData(asin, 'æµè§ˆå™¨æ‹¦æˆªå¼¹çª—');
                showMsg('error', `âš ï¸ ${asin} é‡‡é›†å¤±è´¥ï¼šæµè§ˆå™¨æ‹¦æˆªäº†å•†å“é¡µå¼¹çª—ï¼è¯·å…è®¸å¼¹çª—åé‡è¯•`);
                renderTableData();
                continue;
            }

            try {
                // æ ¡éªŒ2ï¼šç­‰å¾…äºšé©¬é€Šé¡µé¢åŠ è½½å®Œæˆ
                showMsg('loading', `ğŸ” ${asin} - ç­‰å¾…äºšé©¬é€Šé¡µé¢åŠ è½½ï¼ˆ${pageLoadWait}ç§’ï¼‰...`);
                await sleep(PAGE_LOAD_WAIT);
                
                // æ£€æµ‹é¡µé¢æ˜¯å¦åŠ è½½å®Œæˆï¼ˆé¿å…ç©ºç™½é¡µï¼‰
                let loadCheckCount = 0;
                while (amazonWin.document.readyState !== 'complete' && loadCheckCount < 3) {
                    showMsg('loading', `ğŸ” ${asin} - é¡µé¢åŠ è½½è¾ƒæ…¢ï¼Œç¬¬${loadCheckCount+1}æ¬¡å»¶é•¿ç­‰å¾…ï¼ˆ+${timeoutExtend}ç§’ï¼‰...`);
                    await sleep(TIMEOUT_EXTEND);
                    loadCheckCount++;
                }

                // æ ¡éªŒ3ï¼šç­‰å¾…å–å®¶ç²¾çµæ’ä»¶åŠ è½½æ•°æ®
                showMsg('loading', `ğŸ” ${asin} - ç­‰å¾…å–å®¶ç²¾çµæ’ä»¶åŠ è½½æ•°æ®ï¼ˆ${pluginLoadWait}ç§’ï¼‰...`);
                await sleep(PLUGIN_LOAD_WAIT);

                // æ ¸å¿ƒï¼šå¤šæ¬¡å°è¯•è¯»å–äºšé©¬é€Šå•†å“é¡µçš„å–å®¶ç²¾çµæ•°æ®
                let amazonPageText = '';
                let retryCount = 0;
                
                while (retryCount < MAX_RETRIES) {
                    try {
                        amazonPageText = amazonWin.document.body.innerText || '';
                        // æ£€æŸ¥æ•°æ®æ˜¯å¦è¶³å¤Ÿ
                        if (amazonPageText.length > 1000) {
                            break; // æ•°æ®è¶³å¤Ÿï¼Œé€€å‡ºé‡è¯•
                        }
                    } catch (err) {
                        // è¯»å–å¤±è´¥ï¼Œç»§ç»­é‡è¯•
                    }
                    
                    retryCount++;
                    showMsg('loading', `ğŸ” ${asin} - æ•°æ®æœªåŠ è½½å®Œå…¨ï¼Œç¬¬${retryCount}æ¬¡é‡è¯•ï¼ˆ+${timeoutExtend}ç§’ï¼‰...`);
                    await sleep(TIMEOUT_EXTEND);
                }

                // å¦‚æœå¤šæ¬¡é‡è¯•åä»æ— æœ‰æ•ˆæ•°æ®
                if (amazonPageText.length < 1000) {
                    throw new Error('é¡µé¢æ•°æ®ä¸è¶³ï¼Œå¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜æˆ–æ’ä»¶æœªåŠ è½½');
                }

                // é‡‡é›†æ‰€æœ‰å­—æ®µï¼ˆå…¼å®¹å–å®¶ç²¾çµæ‰€æœ‰æ•°æ®ä½ç½®ï¼‰
                let asinData = {
                    asin: asin,
                    bigCateRank: getMatchData(amazonPageText, /Best Seller in (.*?) \((\d+,?\d*)\)/, /å¤§ç±»[:ï¼š](.*?)[:ï¼š](\d+,?\d*)/),
                    smallCateRank: getMatchData(amazonPageText, /å°ç±»[:ï¼š](.*?)[:ï¼š](\d+,?\d*)/, /ç»†åˆ†ç±»ç›®[:ï¼š](.*?)[:ï¼š](\d+,?\d*)/),
                    price: getMatchData(amazonPageText, /\$(\d+\.\d{2})(\s*-\s*\$(\d+\.\d{2}))?/, /å”®ä»·[:ï¼š]\s*(\d+\.\d{2})\s*ç¾é‡‘/),
                    monthSale: getMatchData(amazonPageText, /æœˆé”€é‡[:ï¼š]\s*(\d+,?\d*)/, /æœˆé”€[:ï¼š]\s*(\d+,?\d*)/),
                    yearSale: getMatchData(amazonPageText, /å¹´é”€é‡[:ï¼š]\s*(\d+,?\d*)/, /è¿‘1å¹´é”€é‡[:ï¼š]\s*(\d+,?\d*)/),
                    onTime: getMatchData(amazonPageText, /ä¸Šæ¶æ—¶é—´[:ï¼š]\s*(\d{4}-\d{1,2}-\d{1,2})/, /Listingåˆ›å»º[:ï¼š]\s*(\d{4}-\d{1,2}-\d{1,2})/),
                    reviewNum: getMatchData(amazonPageText, /å…¨çƒè¯„è®º[:ï¼š]\s*(\d+,?\d*)/, /è¯„è®ºæ•°[:ï¼š]\s*(\d+,?\d*)/),
                    rating: getMatchData(amazonPageText, /è¯„åˆ†[:ï¼š]\s*(\d\.\d)/, /Rating[:ï¼š]\s*(\d\.\d)/),
                    followNum: getMatchData(amazonPageText, /è·Ÿå–[:ï¼š]\s*(\d+)/, /è·Ÿå–æ•°é‡[:ï¼š]\s*(\d+)/, '0'),
                    shipping: getMatchData(amazonPageText, /å‘è´§æ–¹å¼[:ï¼š]\s*(FBA|FBM)/, /ç‰©æµ[:ï¼š]\s*(FBA|FBM)/, 'æœªçŸ¥'),
                    variantNum: getMatchData(amazonPageText, /å˜ä½“[:ï¼š]\s*(\d+)/, /å˜ä½“æ•°é‡[:ï¼š]\s*(\d+)/, '1'),
                    newTag: getMatchData(amazonPageText, /æ–°å“æ ‡[:ï¼š]\s*(æœ‰|æ— )/, /New Release[:ï¼š]\s*(æ˜¯|å¦)/, 'æ— '),
                    newReview: getMatchData(amazonPageText, /30å¤©æ–°å¢è¯„è®º[:ï¼š]\s*(\d+,?\d*)/, /è¿‘æœŸè¯„è®º[:ï¼š]\s*(\d+,?\d*)/, '0'),
                    goodRate: getMatchData(amazonPageText, /å¥½è¯„ç‡[:ï¼š]\s*(\d+%)/, /æ»¡æ„åº¦[:ï¼š]\s*(\d+%)/, 'æš‚æ— '),
                    brand: getMatchData(amazonPageText, /å“ç‰Œ[:ï¼š]\s*(.+)/, /Brand[:ï¼š]\s*(.+)/, 'æ— å¤‡æ¡ˆ')
                };

                // æ ¡éªŒ4ï¼šæ˜¯å¦é‡‡é›†åˆ°æœ‰æ•ˆæ•°æ®
                let validData = false;
                Object.values(asinData).forEach(val => {
                    if (val && val !== 'æš‚æ— æ•°æ®' && val !== '0' && val !== 'æœªçŸ¥' && val !== '1' && val !== 'æ— ' && val !== 'æ— å¤‡æ¡ˆ') {
                        validData = true;
                    }
                });

                if (validData) {
                    asinDataList.push(asinData);
                    successCount++;
                    showMsg('error', '');
                } else {
                    throw new Error('æœªé‡‡é›†åˆ°å–å®¶ç²¾çµæ•°æ®ï¼ˆæ’ä»¶æœªåŠ è½½/éç¾å›½ç«™/å•†å“ä¸å­˜åœ¨ï¼‰');
                }

            } catch (err) {
                // é‡‡é›†å¤±è´¥å¤„ç†
                failCount++;
                addFailData(asin, err.message);
                showMsg('error', `âŒ ${asin} é‡‡é›†å¤±è´¥ï¼š${err.message}`);
            } finally {
                // ç¡®ä¿æ•°æ®å¤„ç†å®Œæˆåå†å…³é—­é¡µé¢
                showMsg('loading', `ğŸ” ${asin} - æ•°æ®å¤„ç†å®Œæˆï¼Œå…³é—­é¡µé¢...`);
                try { 
                    if (!amazonWin.closed) amazonWin.close(); 
                } catch (e) {}
                // å®æ—¶æ¸²æŸ“è¡¨æ ¼
                renderTableData();
            }
        }

        // 5. é‡‡é›†å®Œæˆæ±‡æ€»
        showMsg('loading', '');
        showMsg('progress', '');
        showMsg('success', `âœ… å…¨è‡ªåŠ¨æŠ“å–å®Œæˆï¼âœ…æˆåŠŸï¼š${successCount}ä¸ª | âŒå¤±è´¥ï¼š${failCount}ä¸ª | ğŸ“Œæ€»è®¡ï¼š${total}ä¸ª`);
        document.getElementById('copyBtn').disabled = false;
        document.getElementById('downBtn').disabled = false;

    } catch (err) {
        showMsg('loading', '');
        showMsg('progress', '');
        showMsg('error', `âŒ ç¨‹åºå¼‚å¸¸ï¼š${err.message}ï¼Œåˆ·æ–°é¡µé¢åé‡è¯•`);
        document.getElementById('getBtn').disabled = false;
    }
}

// è¾…åŠ©å‡½æ•°ï¼šæ­£åˆ™åŒ¹é…æ•°æ®
function getMatchData(text, reg1, reg2, def = 'æš‚æ— æ•°æ®') {
    if (!text) return def;
    let res = reg1.exec(text);
    if (res && res[0]) return res[0];
    res = reg2.exec(text);
    return res && res[0] ? res[0] : def;
}

// è¾…åŠ©å‡½æ•°ï¼šæ·»åŠ å¤±è´¥æ•°æ®
function addFailData(asin, reason = 'é‡‡é›†å¤±è´¥') {
    let failData = { asin: asin };
    const fields = ['bigCateRank','smallCateRank','price','monthSale','yearSale','onTime','reviewNum','rating','followNum','shipping','variantNum','newTag','newReview','goodRate','brand'];
    fields.forEach(field => failData[field] = reason);
    asinDataList.push(failData);
}

// è¾…åŠ©å‡½æ•°ï¼šæ˜¾ç¤ºæ¶ˆæ¯
function showMsg(type, text) {
    const el = document.getElementById(type + 'Text');
    el.innerText = text;
    el.style.display = text ? 'block' : 'none';
}

// æ¸²æŸ“è¡¨æ ¼æ•°æ®
function renderTableData() {
    const tbody = document.getElementById('tableBody');
    if (asinDataList.length === 0) {
        tbody.innerHTML = '<tr><td colspan="16">æš‚æ— æ•°æ®ï¼Œå¡«å†™ASINåç‚¹å‡»æŠ“å–æŒ‰é’®å³å¯</td></tr>';
        return;
    }
    let html = '';
    asinDataList.forEach(item => {
        html += `<tr>
            <td>${item.asin}</td><td>${item.bigCateRank}</td><td>${item.smallCateRank}</td><td>${item.price}</td>
            <td>${item.monthSale}</td><td>${item.yearSale}</td><td>${item.onTime}</td><td>${item.reviewNum}</td>
            <td>${item.rating}</td><td>${item.followNum}</td><td>${item.shipping}</td><td>${item.variantNum}</td>
            <td>${item.newTag}</td><td>${item.newReview}</td><td>${item.goodRate}</td><td>${item.brand}</td>
        </tr>`;
    });
    tbody.innerHTML = html;
}

// å¤åˆ¶åˆ°Excelï¼ˆè‡ªåŠ¨å¯¹é½ï¼‰
async function copyAllData() {
    try {
        let head = `ASIN\tå¤§ç±»å+æ’å\tå°ç±»ç›®å+æ’å\té”€å”®ä»·(ç¾é‡‘)\tæœˆé”€é‡\tè¿‘1å¹´é”€é‡\tä¸Šæ¶æ—¶é—´\tç´¯è®¡è¯„è®ºæ•°\tRatingè¯„åˆ†\tè·Ÿå–æ•°é‡\tFBA/FBM\tå˜ä½“æ•°é‡\tæ–°å“æ ‡\t30å¤©æ–°å¢è¯„è®º\tå¥½è¯„ç‡(%)\tå“ç‰Œåç§°\n`;
        let content = asinDataList.map(item => `${item.asin}\t${item.bigCateRank}\t${item.smallCateRank}\t${item.price}\t${item.monthSale}\t${item.yearSale}\t${item.onTime}\t${item.reviewNum}\t${item.rating}\t${item.followNum}\t${item.shipping}\t${item.variantNum}\t${item.newTag}\t${item.newReview}\t${item.goodRate}\t${item.brand}`).join('\n');
        await navigator.clipboard.writeText(head + content);
        showMsg('success', 'âœ… å¤åˆ¶æˆåŠŸï¼æ‰“å¼€Excelç›´æ¥Ctrl+Vå³å¯ï¼');
    } catch (err) {
        showMsg('error', `âŒ å¤åˆ¶å¤±è´¥ï¼š${err.message}`);
    }
}

// ä¸‹è½½Excelåˆ†æè¡¨
function downloadExcel() {
    try {
        let excel = [['ASIN','å¤§ç±»å+æ’å','å°ç±»ç›®å+æ’å','é”€å”®ä»·(ç¾é‡‘)','æœˆé”€é‡','è¿‘1å¹´é”€é‡','ä¸Šæ¶æ—¶é—´','ç´¯è®¡è¯„è®ºæ•°','Ratingè¯„åˆ†','è·Ÿå–æ•°é‡','FBA/FBM','å˜ä½“æ•°é‡','æ–°å“æ ‡','30å¤©æ–°å¢è¯„è®º','å¥½è¯„ç‡(%)','å“ç‰Œåç§°']];
        asinDataList.forEach(item => excel.push([
            item.asin,item.bigCateRank,item.smallCateRank,item.price,item.monthSale,item.yearSale,
            item.onTime,item.reviewNum,item.rating,item.followNum,item.shipping,item.variantNum,
            item.newTag,item.newReview,item.goodRate,item.brand
        ]));
        let blob = new Blob([excel.map(row=>row.join(',')).join('\n')],{type:'application/vnd.ms-excel'});
        let a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `äºšé©¬é€Šç«å“æ•°æ®_${new Date().toLocaleDateString().replace(/\//g,'-')}.xls`;
        a.click();
        showMsg('success', 'âœ… Excelä¸‹è½½æˆåŠŸï¼');
    } catch (err) {
        showMsg('error', `âŒ ä¸‹è½½å¤±è´¥ï¼š${err.message}`);
    }
}

// æ¸…ç©ºæ‰€æœ‰æ•°æ®
function resetAllData() {
    asinDataList = [];
    renderTableData();
    document.getElementById('copyBtn').disabled = true;
    document.getElementById('downBtn').disabled = true;
    showMsg('success', 'âœ… å·²æ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼');
    showMsg('error', '');
}

// å»¶æ—¶å‡½æ•°
function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}
</script>
</body>
</html>
